<% set_meta_tags :title => @organizer.name + t('.title'),
                   :description => t('.meta_description') + ' ' + @organizer.name + ' ' +  t('.meta_description2')%>

<% content_for :head do %>  
  <%= auto_discovery_link_tag( :rss, organizer_url(:format => 'rss') , {:title => @organizer.name + t('app.s') + ' ' + t('.organizers_event') + ' ' + t('app.at') + ' ' +  t('app.site_name')}) %>
<% end %>                     
                   
<% content_for :right_column_facts do %>
<% end %>

<%= open_graph_properties @organizer.name, 
                          request.protocol + request.host_with_port + @organizer.logotype.url(:large), 
                          organizer_path(@organizer, 
                          :only_path => false)  %>

<% if current_user %>
  <% if current_user.authorized? @organizer %>
    <%= button_to(  t('.edit'), 
                    edit_organizer_path(@organizer), 
                    :method => :get, 
                    :class => :organizer_user) %>
  <%end%>
  <% if current_user.is_admin? %>
      <%= button_to(  t('.destroy'), 
                    @organizer, 
                    :confirm => t('app.are_you_sure') + ' ' +@organizer.name + '?', 
                    :method => :delete ) %>
  <%end%>
<%end%>




<div class = "page_heading">
  <% unless @organizer.logotype.blank? %>
    <%= image_tag @organizer.logotype.url(:medium),
                  :class => :page_logotype,
                  :alt => t('.logotype_for') + ' ' + @organizer.name 
                  %>
  <%end%>
  <h1><%= @organizer.name %></h1>
  <h3><%= @organizer.intro %></h3>
  <%= facebook_like organizer_path(:only_path => false), "top", "like" %>
</div>
<div class = "break"></div>

<%= image_tag @organizer.photo.url(:medium), :class => :organizer_photo %>

<p>
  <%= simple_format @organizer.description %>
</p>

<p class = "break">
<% unless @organizer.website.blank? %>
  <strong><%=t '.website' =%>:</strong>
  <%= link_to @organizer.website, @organizer.website %>
</p>
<p>
<% end %>

  <strong><%=t '.contact' %>:</strong>
  <% unless @organizer.phone.blank? %>
    <br /><%= @organizer.phone%>
  <% end %>
  <% unless @organizer.email.blank? %>
  <br /><%= @organizer.email %>
  <% end %>
</p>


<h3><%= t '.upcoming' %></h3>

<% if @organizer.upcoming_events.blank? %>  
  <p><%= t('.at_the_moment') + ' ' + @organizer.name + ' ' + t('.has_no_events') %> 
  <% if current_user %>
    <% unless !current_user.organizers.include? @organizer and !current_user.is_admin? %>
      <%= link_to t('.new_event'), new_event_path %>.
    <% end %>
  <% end %>
  </p>
<% else %>
    <%= will_paginate( 
          @events,
          :renderer => GmailPaginationLinkRenderer,
          :first_label => t('will_paginate.first'),
          :previous_label => t('will_paginate.previous'),
          :next_label => t('will_paginate.next'),
          :last_label => t('will_paginate.last'),
          :summary_label => " %d #{t('will_paginate.to')} %d #{t('will_paginate.of')} %d "
          ) %>
  <%= calendar @events %>
  <%= will_paginate( 
          @events,
          :renderer => GmailPaginationLinkRenderer,
          :first_label => t('will_paginate.first'),
          :previous_label => t('will_paginate.previous'),
          :next_label => t('will_paginate.next'),
          :last_label => t('will_paginate.last'),
          :summary_label => " %d #{t('will_paginate.to')} %d #{t('will_paginate.of')} %d "
          ) %>
<% end %>

<p>
<%= link_to @organizer.name + t('.previous_events'), events_path(:organizer_id => @organizer.id, :start => :past) %>
</p>

<p>
<%= link_to t('.subscribe_rss') + ' ' + @organizer.name + t('app.s') + ' ' + t('.organizers_event'), :format => :rss, :only_path => false %>  
<%= link_to image_tag("rss_icon.gif", :alt => t('.rss_alt') + ' ' + @organizer.name), :format => :rss, :only_path => false %>
</p>

<p>
<%= link_to(t('.download_ics'), organizer_url(:only_path => false, :format => :ics ))  %>
</p>




<%= content_for :right_column_bottom do %>  
  <div class = "box" id = "promote_municipality">
    <span class="heading"><%= t('.promote')%><br /> <%=@organizer.name%>:</span>
    <p>
      <%= link_to t('.subscribe_rss') + ' ' + @organizer.name + t('app.s') + ' ' + t('.organizers_event'), :format => :rss, :only_path => false %>  
      <%= link_to image_tag("rss_icon.gif", :alt => t('.rss_alt') + ' ' + @organizer.name), :format => :rss, :only_path => false %>
    </p>

    <p>
      <%= link_to(t('.download_ics'), organizer_url(:only_path => false, :format => :ics ))  %>
    </p>

    <p>
    <%= t('.share_as_iframe') %>
    </p>
    <%= text_area_tag( "id", h('<iframe src="' + organizer_url(:format => :ihtml) + '"  frameborder="1" ></iframe>'), :class => :iframe_me, :readonly => true) %>
  </div> <!-- /promote_organizer -->
<% end %>


<%= facebook_like organizer_path(:only_path => false), "bottom", "like" %>



<% if current_user %>
  <% if current_user.authorized? @organizer %>
  <hr />
  <h2><%= t '.for_organizers'%></h2>
  <div class = "authorized">
  
  
  <h3><%= t('.members_in') + ' ' + @organizer.name %>:</h3>
  <table class = "general">
     <tr>
      <th></th>
      <th><%= t '.email'%></th>
      <th><%= t '.first_name'%></th>
      <th><%= t '.last_name'%></th>
      <th></th>
    </tr>
    <% for user in @organizer.users %>
    <tr class = "<%= cycle("even", "odd") %>">
      <td><%= image_tag avatar_url(user) %></td>
      <td><%= link_to user.email , user %></td>
      <td><%= link_to user.first_name , user %></td>
      <td><%= link_to user.last_name , user %></td>
      <td>
        <% unless user == current_user %>
          <%= button_to I18n.t('organizers.show.unmember') , membership_path(Membership.find(:first, :conditions => ["organizer_id = ? and user_id = ?", @organizer.id, user.id])), :confirm => I18n.t('organizers.show.sure_unmember') + user.name, :method => :delete %> 
        <%else%>
          <%= t '.dont_leave'%>
        <% end %>
      </td>
    </tr>
    <% end %> 
  </table>

  
  <p>&nbsp;</p>

  <h3>Användare som vill bli administratörer för <%= @organizer.name %>:</h3>
  <% unless @organizer.memberships.find(:all, :conditions => ["prospect_user_id <> ? ", "null"]).blank? %>
    <p>Om du inte agerar så kommer användarna att plockas bort från listan efter ... veckor. TODO</p>
    <table class = "general">
      <% for membership in @organizer.memberships.find(:all, :conditions => ["prospect_user_id <> ? ", "null"]) %>
        <% user = User.find membership.prospect_user_id %>
        <tr class = "<%= cycle("even", "odd") %>">
          <td><%= image_tag avatar_url(user) %></td>
          <td><%= link_to user.name , user %>:<br /><%= membership.argumentation %></td>
          <td>
              <%= button_to   t('.promote_prospect'), 
                              membership_promote_prospect_path(membership, 
                                                                :organizer_id => @organizer.id,
                                                                :user_id => user.id,
                                                                :membership_id => membership.id), 
                              :method => :put, 
                              %>                         
          </td>
          <td>
              <%= button_to t('.cancel_prospect'), 
                            membership_path(Membership.find(:first, :conditions => ["organizer_id = ? and user_id = ?", @organizer.id, user.id])),
                            :confirm => t('.confirm_cancel_prospect1') + user.name + t('.confirm_cancel_prospect2') + @organizer.name + t('.note_legal') 
                            %> 
          </td>
        </tr>
      <% end %> 
    </table>
    <p>§ Liten text om att dela ut behöigheter. Den som du gör till administratör kommer att få samma behörighet som du och andra adminstratörer... Personen som ansökt om att bli adminstratör kommer att få ett mejl när du godkänner eller avslår ansökan. TODO</p>
  <%else%>
    <p>Just nu finns det inga ansökningar.</p>
  <%end%>
<p>
  <h3><%= t '.all_registered_users' %>:</h3>
</p>

<ol class = "user_list">
<% @users = User.all %>
  <% for user in @users %>
    <li><div class = "user">
      <%= link_to user.name , user %> </div>
      <%= button_to I18n.t('organizers.show.make_member') , memberships_path(:user_id => user.id, :organizer_id => @organizer) %>
    </li>  
  <% end %>
</ol>
  </div> <!-- authorized -->
<% end %>
<% end %>

