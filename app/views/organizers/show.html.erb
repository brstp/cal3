<% set_meta_tags :title => @organizer.name + t('.title'),
                   :description => t('.meta_description') + ' ' + @organizer.s + ' ' +  t('.meta_description2')%>

<% content_for :head do %>  
  <%= auto_discovery_link_tag( :rss, organizer_url(:format => 'rss') , {:title => @organizer.s + ' ' + t('.organizers_event') + ' ' + t('app.at') + ' ' +  t('app.site_name')}) %>
  <link rel = "canonical" href="<%= t('app.site_url') + organizer_path(@event) %>"/> 
<% end %>                     
                   

<%= open_graph_properties @organizer.name, 
                          @organizer.logotype.url(:medium), 
                          organizer_path(@organizer, 
                          :only_path => false)  %>

<% if current_user %>
  <% if (@organizer.users.include? current_user) || current_user.is_admin? %>
    <div class = "user_message">
        
          <% if @organizer.users.include? current_user %>
            <p><%= t('.you_are_admin_for') + ' '+ @organizer.name %>. </p>
          <% end %>
          
          
          <% if current_user.is_admin? %>
            <p><%= t('.you_are_sysadmin') %>. </p>
          <% end %>
          
          <% unless @organizer.petition_users.blank? %>
            <p>
              <%= link_to t('.you_have_petitions'), 
                          :anchor => :admin %>
            </p>
          <% end %>  
        </p>
        <p>
        <% if @organizer.upcoming_events.blank? %>
          <%= link_to t('.new_event'), new_event_path(:organizer_id => @organizer.id) %>
        <% else %>
          <%= link_to   t('.new_event'), 
                      new_event_path(:organizer_id => @organizer.id) %>
        <% end %>              
      </p>
        <%= button_to(  t('.edit'), 
                      edit_organizer_path(@organizer), 
                      :method => :get, 
                      :class => :organizer_user) %>                      
    <% if current_user.is_admin? %>
      <%= button_to(  t('.destroy'), 
                    @organizer, 
                    :confirm => t('app.are_you_sure') + ' ' +@organizer.name + ' ' + t('.and_events_and_memberships') + '?', 
                    :method => :delete ) %>
    <% end # is_admin %>
      
    </div>
  <% end %>
  <% if @organizer.petition_users.include? current_user %>
    <div class = "user_message">
        <p>
          <%= link_to( t('.you_have_applied') + ' ' + @organizer.name, @organizer.petitions.find_by_user_id(current_user.id) )  %>.
        </p>
    </div>
    <% else %>
      <% if params[:recruit] %>
        <div class = "user_message">
          <p>
            <%= t('.do_you_work_for') + ' ' + @organizer.name%>? 
            <%= link_to t('.apply_for_adminship'), 
                        new_petition_path( :organizer_id => @organizer.id ) %>
          </p> 
        </div>
      <% end %>
    <% end %>
  

  
  <% end #current_user %>


  
  
  
  

<div class = "page_heading">
  <% unless @organizer.logotype.blank? %>
    <%= image_tag @organizer.logotype.url(:medium),
                  :class => :page_logotype,
                  :alt => t('.logotype_for') + ' ' + @organizer.name 
                  %>
  <% end %>
  <h1><%= @organizer.name %></h1>
  <h3><%= @organizer.intro %></h3>
  <%= facebook_like organizer_path(:only_path => false), "top", "like" %>
</div>

<div class = "break"></div>


<div class = "image_box">
  <%= link_to_unless @organizer.photo_url.blank? || @organizer.photo_file_name.blank?, (image_tag( @organizer.photo.url(:medium), :title => @organizer.photo_caption, :alt => @organizer.photo_caption)), @organizer.photo_url, :rel => :nofollow %><br />
  <div class = "image_caption">
    <% unless @organizer.photo_file_name.blank? %>
      <%= @organizer.photo_caption %>
    <%end %>
  </div>
  
</div>

<%= simple_format @organizer.description %>


<p class = "break"></p><p>
<% unless @organizer.website.blank? %>
  <strong><%=t '.website' =%>:</strong>
  <%= link_to_unless @organizer.events.blank?, @organizer.website, @organizer.website %>
  </p>
  <p>
<% end %>

<strong><%=t '.contact' %>:</strong>
<% unless @organizer.phone.blank? %>
  <br /><%= @organizer.phone%>
<% end %>
<% unless @organizer.email.blank? %>
  <br /><%= @organizer.email %>
<% end %>
</p>


<h3><%= t '.upcoming' %></h3>

<% if @organizer.upcoming_events.blank? %>  
  <p><%= t('.at_the_moment') + ' ' + @organizer.name + ' ' + t('.has_no_events') %> 
  <% if current_user %>
    <% unless !current_user.organizers.include? @organizer and !current_user.is_admin? %>
      <%= link_to t('.first_event'), new_event_path(:organizer_id => @organizer.id) %>
    <% end %>
  <% end %>
  </p>
<% else %>
    <%= will_paginate( 
          @events,
          :renderer => CustomPaginationLinkRenderer,
          :first_label => t('will_paginate.first'),
          :previous_label => t('will_paginate.previous'),
          :next_label => t('will_paginate.next'),
          :last_label => t('will_paginate.last'),
          :summary_label => " %d #{t('will_paginate.to')} %d #{t('will_paginate.of')} %d "
          ) %>
  <%= calendar @events %>
  <%= will_paginate( 
          @events,
          :renderer => CustomPaginationLinkRenderer,
          :first_label => t('will_paginate.first'),
          :previous_label => t('will_paginate.previous'),
          :next_label => t('will_paginate.next'),
          :last_label => t('will_paginate.last'),
          :summary_label => " %d #{t('will_paginate.to')} %d #{t('will_paginate.of')} %d "
          ) %>
          
        
<% end %>

<p><strong><%= t '.hint_store'%>:</strong></p>
<ul class = "organizer-actions" >
<% if @organizer.future_events? %>
  <li>
    <%= link_to(t('.download_ics1') + ' ' + @organizer.s + ' ' + t('.download_ics2'), organizer_url(:only_path => false, :format => :ics ), :title => t('app.ics_file'))  %>
  </li>
<% end %>

  <li>
    <%= link_to t('.subscribe_rss') + ' ' + @organizer.name, :format => :rss, :only_path => false %>  
    <%= link_to image_tag("rss_icon.gif", :alt => t('.rss_alt') + ' ' + @organizer.name), :format => :rss, :only_path => false %>
    <%= link_to t('.whats_rss'), "http://sv.wikipedia.org/wiki/RSS-l%C3%A4sare", :rel => :nofollow %>
  </li>

<% if @organizer.past_events? %>
  <li>
    <%= link_to @organizer.s + ' ' + t('.previous_events'), events_path(:organizer_id => @organizer.id, :stop => :past) %>
  </li>
<% end %>

</ul>

<%= facebook_like organizer_path(:only_path => false), "bottom", "like" %>



<p class = "created-updated" >
<%= t '.created_at' %> <%= I18n.localize @organizer.created_at, :format => :default %>  
  <% if current_user %>
    <% if (current_user.authorized? @organizer) || current_user.is_admin? %>
      <%= @organizer.created_by %>      
    <% end %>
  <% end %> 
<% unless @organizer.created_at == @organizer.updated_at || @organizer.updated_by_user_id.nil?%>
  <%= t '.updated_at' %> <%= I18n.localize @organizer.updated_at, :format => :default %>
  <% if current_user %>
    <% if (current_user.authorized? @organizer) || current_user.is_admin? %>
      <%= @organizer.updated_by %>
    <% end %>
  <% end %>
<% end %>

<%= link_to t(".edit"), edit_organizer_path %>. 
<% if @organizer.may_recruit? current_user %>
    <%= t('.do_you_work_for') + ' ' + @organizer.name%>? 
    <%= link_to t('.apply_for_adminship'), 
                new_petition_path( :organizer_id => @organizer.id ) %>
<% end %>
Arrangörssidan (text & bilder) är licensierad under en <a rel="license" rel="nofollow" href="http://creativecommons.org/licenses/by-sa/2.5/se/">Creative Commons Erkännande-DelaLika 2.5 Sverige Licens</a>. 
</p>


<% if current_user %>
  
  <% if current_user.authorized?(@organizer) || current_user.is_admin? %>
    </div><div class="post" id = "admin">
    <h2><%= t '.for_organizers'%></h2> 
    <div class = "authorized">
 
<p>
    <%= link_to   t('.new_event'), 
                    new_event_path(:organizer_id => @organizer.id) %>
</p>
    <h3>Användare som vill bli administratörer för <%= @organizer.name %>:</h3>

    <% unless @organizer.petition_users.blank?  %>
      <p><%= t '.petitions_to_be_purged' %></p>
      <table class = "general">
        <tr>
          <th></th>
          <th><%= t '.petitions'%></th>
          <th></th>
        </tr>
        <% for petition in @organizer.petitions %>
          <tr class = "<%= cycle("even", "odd") %>">
            <td><%= image_tag avatar_url(petition.user) %><br /></td>
            <td>
                <%= 
                  if current_user.is_admin
                    link_to petition.user , petition.user 
                  else
                    petition.user 
                  end
                %>: <br /> 
                <%= l(petition.created_at) %>. Anledning till ansökan:<br />
                 
                <%= petition.argumentation %></td>
            <td>
                <%= link_to   t('.approve_user'), 
                      edit_petition_path(petition) %>
            </td>
          </tr>
        <% end #petitions %> 
        <% reset_cycle %>
      </table>
    <% else %>
      <p><%= t '.no_petitions'%></p>
    <% end #petition_users.blank? %>

  <h3><%= t('.members_in') + ' ' + @organizer.name %>:</h3>
  <table class = "general">
    <table class = "general">
      <tr>
        <th></th>
        <th><%= t '.users'%></th>
        <th></th>
      </tr>
    <% for user in @organizer.users %>
    <tr class = "<%= cycle("even", "odd") %>">
      <td><%= image_tag avatar_url(user) %><br /></td>
      <td>
      <%= 
      if current_user.is_admin
        link_to user, user 
      else
        user
      end
      %></td>
      <td>
        <% unless user == current_user %>
          <%= button_to I18n.t('organizers.show.unmember') , membership_path(Membership.find(:first, :conditions => ["organizer_id = ? and user_id = ?", @organizer.id, user.id])), :confirm => I18n.t('organizers.show.sure_unmember') + user.name, :method => :delete %> 
        <%else%>
          <%= t '.dont_leave'%>
        <% end %>
      </td>
    </tr>
    <% end #users %> 
    <% reset_cycle %>
  </table>
</div> <!-- authorized -->
  <% end #authorized @organizer %>
<% end #current_user %>


<%= content_for :right_column_bottom do %>  
  <div class = "box" id = "promote_organizer">
    <span class="heading"><%= t('.promote')%><br /> <%=@organizer.name%>:</span>

      <% if @organizer.future_events? %>
        <p>
          <%= link_to(t('.download_ics1') + ' ' + @organizer.s + ' ' + t('.download_ics2'), organizer_url(:only_path => false, :format => :ics ), :title => t('app.ics_file'))  %>
        </p>
      <% end %>

      <p>
        <%= link_to t('.subscribe_rss') + ' ' + @organizer.name, :format => :rss, :only_path => false %>  
        <%= link_to image_tag("rss_icon.gif", :alt => t('.rss_alt') + ' ' + @organizer.name), :format => :rss, :only_path => false %>
        <%= link_to t('.whats_rss'), "http://sv.wikipedia.org/wiki/RSS-l%C3%A4sare", :rel => :nofollow %>
      </p>


    <p>
    <%= t('.share_as_iframe') %>
    </p>
    <%= text_area_tag( "id", h('<iframe src="' + organizer_url(:format => :ihtml) + '"  frameborder="1" ></iframe>'), :class => :iframe_me, :readonly => true) %>
  </div> <!-- /promote_organizer -->
<% end #right_column_bottom %>
