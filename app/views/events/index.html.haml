.content
  %article.article{:role => "main"}
    %header
      = render "flashes"   
      
      
    
    
      
      
    .search_container
      .search_box
        .search_heading
          .search_label
            Sök evenemang, ämne, plats:
          .clear_link
            - unless params[:q].blank? && params[:stop].blank? && params[:start].blank? && params[:category_facet_id].blank? && params[:organizer_id].blank? && params[:municipality_id].blank?
              = link_to "rensa sökningen", events_path
        = form_tag({:action => 'index'}, :method => 'get' )            
        = search_field_tag :q, params[:q]   
        = hidden_field_tag :municipality_id, params[:municipality_id]
        = hidden_field_tag :organizer_id, params[:organizer_id]
        = hidden_field_tag :category_facet_id, params[:category_facet_id]
        = hidden_field_tag :start, params[:start]
        = hidden_field_tag :stop, params[:stop]
        
        = #search_field_tag :search, "punk malmö juni"
        .submit_row 
          = submit_tag "Sök", :id => :event_search
  
      .three_cols
      
        - # subject category
        .facet_column_first
          %h5 vad/ämne
          %ul
            - for row in @category_facet_rows
              - if row.value.to_i == params[:category_facet_id].to_i
                %li.selected_facet
                  %a{:href => "#{events_path( :q => params[:q], :start => params[:start], :stop => params[:stop], :category_facet_id => nil, :organizer_id => params[:organizer_id], :municipality_id => params[:municipality_id])}"}
                    %span.cancel_facet x
                    %span= "#{row.instance.and_mum.to_s} (#{row.count.to_s})"
              - else
                %li
                  = link_to "#{row.instance.and_mum.to_s} (#{row.count.to_s})", events_path( :q => params[:q], :start => params[:start], :stop => params[:stop], :category_facet_id => row.instance.id, :organizer_id => params[:organizer_id], :municipality_id => params[:municipality_id]), :title => "Sök evenemang bara i kategorin #{row.instance.to_s}."

 
        - # time span              
        .facet_column_second
          %h5 när/datum
          %ul
            - for row in @stop_facet_rows
              - if row.value == params[:stop]
                %li.selected_facet
                  %a{:href => "#{events_path( :q => params[:q], :start => params[:start], :stop => nil, :category_facet_id => params[:category_facet_id], :organizer_id => params[:organizer_id], :municipality_id => params[:municipality_id])}"}
                    %span.cancel_facet x
                    %span= "#{t('when_facet.' + row.value.to_s)} (#{row.count.to_s})"
              - else
                %li
                  = link_to "#{t('when_facet.' + row.value.to_s)} (#{row.count.to_s})", events_path(:q => params[:q], :start => params[:start], :stop => row.value, :category_facet_id => params[:category_facet_id], :organizer_id => params[:organizer_id], :municipality_id => params[:municipality_id]), :title => "Sök evenemang bara i #{t('when_facet.' + row.value.to_s)}."


        - # location
        .facet_column_third
          %h5 var/ort 
          %ul
            - if params[:municipality_id].blank?
              - unless @municipality_facet_rows.blank? 
                - for row in @municipality_facet_rows
                  %li
                    = link_to "#{row.instance.to_s} (#{row.count.to_s})", events_path( :q => params[:q], :start => params[:start], :stop => params[:stop], :category_facet_id => params[:category_facet_id], :organizer_id => params[:organizer_id], :municipality_id => row.instance.id), :title => "Sök evenemang bara i #{row.instance.to_s}."
            - else
              - for row in @municipality_facet_rows
                %li.selected_facet
                  %span.cancel_facet= link_to "x", events_path( :q => params[:q], :start => params[:start], :stop => params[:stop], :category_facet_id => params[:category_facet_id], :organizer_id => params[:organizer_id], :municipality_id => nil), :title => "Sök överallt."
                  %span= link_to "#{row.instance.to_s} (#{row.count.to_s})", events_path( :q => params[:q], :start => params[:start], :stop => params[:stop], :category_facet_id => params[:category_facet_id], :organizer_id => params[:organizer_id], :municipality_id => nil), :title => "Sök överallt, inte bara i #{row.instance.to_s}"

               
    - unless @events.blank?
      %h6 Visar #{@events.count} av ... evenemang

      %table.mini_calendar
        %tbody
          - for event in @events
            %tr{:itemscope => true, :itemtype => "http://schema.org/Event"}
              %td
                <a class='inline_div' href='#{event_path event}' title='#{event.subject}. #{event.intro}'>
                .calendar_day
                  .weekday #{l(event.start_datetime, :format => :abbr_day_of_week)}
                  .day_of_month #{l(event.start_datetime, :format => :day_of_month)}
                  .month #{l(event.start_datetime, :format => :abbr_month_of_year)}
                </a>
              %td
                %span.event_row
                  = link_to raw( event.subject + ' (' + event.category.name + ')' + '. ' + event.organizer.name + ', ' + event.municipality.short_name + '. ' + 'Kl.&nbsp;' + l(event.start_datetime, :format => :time) + '.' ), event_path(event), :title => event.intro, :itemprop => :url
                  <meta itemprop="startDate" content="#{l(event.start_datetime, :format => :machine)}">
                  <meta itemprop="description" content="#{event.intro}}">
                  <meta itemprop="name" content="#{event.subject}}">
                  <meta itemprop="performer" content="#{event.organizer.name}}">
                  <meta itemprop="addressLocality" content="#{event.location}}">
      %p 
        = link_to "Visa alla inplanerade evenemang", events_path  
    - else
      %p Just nu finns det inte några evenemang inplanerade. 
    %p #{ link_to "Lägg in ett evenemang...", new_event_path }
  
  %aside{:role => "complementary"}
    = render 'aside_index'

- set_meta_tags :title => "Allom - evenemangskalender för alla sorters evenemang och aktiviteter.", :description => "Hitta saker att göra. Lägg in dina evenemang på evenemangskalendern Allom. Snabbt och enkelt. Kostnadsfritt konto."

